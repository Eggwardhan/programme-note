## ARM 架构
- cortex-A-R arm11既支持ARM(32)又支持THUMB(16)指令集状态。而在ARM Cortex-M中不再支持ARM。仅支持Thumb1,Thumb2(兼容16与32)
#### UAL
- 书写thumb-2指令时不需要分析16/32位。
- 一般汇编成16位。有立即数的汇编成32位，加后缀.W指定32 .N指定16位。
- 指令格式<opcod\>{<cond\>}{S}  <Rd\>,<Rn\>  {,<shifter_operand>}
- 其中opcode为指令操作码 cond为执行条件，S代表指令执行是否影响应用程序状态寄存器APSR（标志）寄存器的值。Rd为目的操作数（寄存器），Rn为第一源操作数（寄存器），shifter_operand为第二源操作数。<\>内的项是必须的{}内为可选

- MOVS R1,R2 ；R2传送到R1，且更新APSR
- 每一条ARM指令都包含4位条件吗（cond）位于指令最高4位，共16种。
- 转移指令加上条件域就是条件转移指令如ADDEQ R1,R2,R3 ;若之前的操作是相等状态（z=1）则执行该add指令。
- 操作数shifter_operand 有三类，立即数方式，寄存器方式，寄存器移位方式。
##### 源操作数方式


1. 立即数方式(#immed_8r)

 - 第二源操作数shifter_operand是一个无符号的32位数值常量#immed_8r，但并不是任意32位立即数都是合法立即数，因为对于32位ARM指令，留给第二操作数立即数的位数只有12位。立即数空间分为两段：一段为8位立即数，另一段4位为循环移位的位数。
 - 32位立即数=immed_8循环右移(2*rotate_imm)位
 - 即一个8为的无符号数值常量，高位用0补全到32位后，循环右移2×rotate_imm偶数次后的一个32位值。rotate_imm只有4位（i:imm3:a)，范围是0~15，所以移位是0~30之间，步长为2.
 - 在不同的架构中ARM立即数规定有所不同。如下表为ARMv7-M架构中Thumb-2指令集关于第二操作数为立即数的指令编码格式，对于一个指定的立即数，其生成方式按另一表规定的编码方式。。

|31|28|27|25|24|21|20|19|16|15|12|11|
|---|---|
|cond||001||opcode|s||Rn||Rd||shifter_operand|


2. 寄存器方式

 ADD R2,R3,R4  ;R2<-R3+R4

 SUB R1,R3,R2  ;R1<-R3-R2

3.  寄存器移位方式

  MOV R0,R2,LSL #3  ;R2逻辑左移3位（相当于×8）后赋值R0寄存器

  - <RM\>,ASR #<shift_imm>/<Rs> ；按照立即数或Rs（通用寄存器，不能为R15）内容指定的次数，对寄存器Rm中的值向右移动，左端用Rm第31位值来填充。算术右移移位相当于有符号数除以2.
  - <Rm\>,LSL #<shift_imm\>/<Rs\>  ;按照。。向右移动，最低位用0填充。逻辑左移移位相当于无符号数乘以2.
  - <Rm\>,LSR #<shift_imm\>/<Rs\>  ;按照。。。向右移动，最高位用0填充，逻辑右移想挡于无符号数除以2.
  - <Rm\>,ROR #<shift_imm\>/<Rs\>  ;向右循环移动，左端用右端移出的位填充。
  - <Rm\>,RRX 对Rm中的值进行带扩展的循环右移，数据都循环右移1位，在循环数据的最高位与最低位之间添加CPSR中的进位标志位C。每右移一位，C标志位移入Rm最高位，Rm的最低位移入C标志位。

### ARM指令寻址方式

#### 立即寻址
- E.X.M.

 - MOV R0,#0  ;R0<-0；32位指令，立即数0XFF传送到R0
 - MOVS R0,#0X104 ;R0<-0x104;32位指令，立即数0x104传送到寄存器R0中
 - ADD R1,R0,#1 ;R1 <- R0 + 1

#### 寄存器直接寻址
这种寻址方式指操作数的值位于CPU的内部寄存器中，是各类处理器中常采用的一种执行效率较高的寻址方式。例如

     Mov R1,R2     ;R1<-R2

     ADD R0,R1,R2  ; R0 <-R1+R2

#### 寄存器移位寻址
寻址操作数由寄存器中的数值进行相应移位得到，移位的方式以助记符形式给出（ASR，LSL等）。移位位数由立即数或者寄存器直接寻址方式给出。

      AND R0,R1,R2,LSL #2 ;R0<-R1 &(R2逻辑左移2位)
      MOV R0,R1,ASR R2    ;R0<-(R1算术右移R2规定的位数)

#### 寄存器间接寻址
寄存器中存放的内容为操作数的内存地址。如

      STR R0,[R1]  ;R0中的值传送到 以R1的值作为地址的存储器中，R1的值不变    -》
      LDR R1,[R2]  ;R2中的值作为地址，将内存中该地址单元的数据传输到R1，R2的值不变  《-

#### 基址变址寻址
      在基址变址寻址中，某个寄存器提供一个基址地址，该基地址将与指令中给出的称为地址偏移量的数据相加，形成有效地址。
